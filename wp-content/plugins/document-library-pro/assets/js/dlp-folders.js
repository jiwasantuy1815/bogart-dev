(()=>{"use strict";const e=window.lodash;jQuery((function(a){const d=function(){a(".dlp-category").on("click",this.handleFolderToggle),a(document).on("input keyup",'.dlp-folders-search input[type="search"]',(0,e.debounce)(this.handleFolderSearch,300)),a(document).on("click",".dlp-folders-reset",this.handleFolderSearchReset),a(".dlp-folders-container").each(((e,d)=>{a(d).show()})),a(".dlp-folder:not(.closed)").each(((e,a)=>{this.openFolder(a)})),a(".dlp-category").on("keydown",this.handleFolderKeydown)};d.prototype.handleFolderToggle=function(e){const d=a(this),l=d.parents(".dlp-folder").first(),o=l.find(".dlp-category-table").first(),t=l.data("category-id"),s=d.parents(".dlp-folders-root").data("shortcode-atts");l.hasClass("closed")&&!l.hasClass("table-loaded")&&(o.block({message:null,overlayCSS:{background:"#fff",opacity:.7}}),a.ajax({url:dlp_folders_params.ajax_url,type:"POST",data:{category_id:t,shortcode_atts:s,action:dlp_folders_params.ajax_action,_ajax_nonce:dlp_folders_params.ajax_nonce},xhrFields:{withCredentials:!0}}).done((function(e){o.html(e.html),"table"===e.layout&&o.children("table").first().postsTable(),o.unblock(),a(document).trigger("dlp_folder_opened",l)})),l.addClass("table-loaded")),l.hasClass("closed")||l.find(".dlp-folder").each((function(e,d){const l=a(d);l.hasClass("closed")||l.addClass("closed")})),l.toggleClass("closed");const r=l.siblings(".dlp-folder").not(l);(-1!==navigator.userAgent.indexOf("Mac")&&!e.metaKey||-1===navigator.userAgent.indexOf("Mac")&&!e.ctrlKey)&&(a(".dlp-category").not(d).attr("aria-expanded","false"),r.each((function(e,d){const l=a(d);l.hasClass("closed")||(l.addClass("closed"),l.find(".dlp-folder").each((function(e,d){const l=a(d);l.hasClass("closed")||l.addClass("closed")})))}))),d.attr("aria-expanded",!l.hasClass("closed"))},d.prototype.openFolder=function(e){const d=a(e);d.find(".dlp-category").first().attr("aria-expanded","true");const l=d.find(".dlp-category-table").first(),o=d.data("category-id"),t=d.parents(".dlp-folders-root").data("shortcode-atts");d.hasClass("table-loaded")||(0===d.find(".dlp-folder:not(.closed)").length&&l.block({message:null,overlayCSS:{background:"#fff",opacity:.7}}),a.ajax({url:dlp_folders_params.ajax_url,type:"POST",data:{category_id:o,shortcode_atts:t,action:dlp_folders_params.ajax_action,_ajax_nonce:dlp_folders_params.ajax_nonce},xhrFields:{withCredentials:!0}}).done((function(e){l.html(e.html),"table"===e.layout&&l.children("table").first().postsTable(),l.unblock(),a(document).trigger("dlp_folder_opened",d)})),d.addClass("table-loaded"))},d.prototype.handleFolderSearch=function(e){const d=a(this),l=d.parents(".dlp-folders-container").first(),o=l.find(".dlp-folders"),t=l.find(".dlp-folders-search-results"),s=l.find(".dlp-folders-reset"),r=l.find(".dlp-folders-root").data("shortcode-atts"),n=!!t.hasClass("search-loaded")&&t.find("> div").attr("id"),c=d.val();if(c.length<dlp_folders_params.ajax_min_search_term_len)return t.hide(),o.show(),void s.hide();s.show(),l.find('.dlp-folders-search input[type="search"]').not(this).each((function(e){a(this).val(d.val())})),l.block({message:null,overlayCSS:{background:"#fff",opacity:.7}}),a.ajax({url:dlp_folders_params.ajax_url,type:"POST",data:{library_id:n,search_query:c,shortcode_atts:r,action:dlp_folders_params.ajax_folder_search,_ajax_nonce:dlp_folders_params.ajax_nonce},xhrFields:{withCredentials:!0}}).done((function(e){o.hide(),t.show(),t.html(e.html),"table"===e.layout&&t.children("table").first().postsTable(),t.addClass("search-loaded"),l.unblock()}))},d.prototype.handleFolderSearchReset=function(e){e.preventDefault();const d=a(this).parents(".dlp-folders-container").first(),l=d.find(".dlp-folders"),o=d.find('.dlp-folders-search input[type="search"]'),t=d.find(".dlp-folders-reset"),s=d.find(".dlp-folders-search-results");o.each((function(e){a(this).val("")})),t.each((function(e){a(this).hide()})),l.show(),s.hide()},d.prototype.handleFolderKeydown=function(e){"Enter"!==e.key&&" "!==e.key&&13!==e.keyCode&&32!==e.keyCode||(e.preventDefault(),a(this).trigger("click"))},new d}))})();