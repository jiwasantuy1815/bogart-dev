(()=>{"use strict";const e=window.wp.i18n,a=window.lodash;jQuery((function(t){function n(e){const a=e.find(".dlp-grid-taxonomy-filter").map((function(){const e=t(this).find(":selected");return console.log(e),{taxonomy:t(this).data("taxonomy"),term:t(this).find(":selected").val()}})).toArray();return a.forEach(((e,t)=>{e.term||a.splice(t,1)})),a}function i(e,a=null){const t=e.find(".dlp-grid-documents");let n=e.find("footer .dlp-grid-pagination"),i=e.find("header .dlp-grid-pagination");const r=e.find("footer .dlp-grid-totals"),d=e.find("header .dlp-grid-totals");a&&a.grid&&t.replaceWith(a.grid),n.length>0&&a&&a.pagination&&n.replaceWith(a.pagination.footer),n=e.find("footer .dlp-grid-pagination"),n.children().length>0?n.show():n.hide(),i.length>0&&a&&a.pagination&&i.replaceWith(a.pagination.header).show(),i=e.find("header .dlp-grid-pagination"),i.children().length>0?i.show():i.hide(),r.length>0&&a&&a.totals&&r.replaceWith(a.totals.footer),d.length>0&&a&&a.totals&&d.replaceWith(a.totals.header),e.trigger("grid-loaded")}new class{constructor(){t(document).on("grid-loaded",".dlp-grid-container",this.handleGridLoaded),t(document).on("dlp_folder_opened",this.handleGridLoaded),t(document).on("click",".dlp-grid-paginate-button",this.handleFetchGrid),t(document).on("click",".dlp-grid-card-featured-img",this.openPhotoswipe),t(document).on("input",'.dlp-grid-search input[type="search"]',(0,a.debounce)(this.handleGridSearch,300)),t(document).on("click",".dlp-grid-reset",this.handleGridReset),t(document).on("select2:select",".dlp-grid-taxonomy-filter",this.handleTaxonomyFilters),t(document).on("select2:select",".dlp-grid-length select",this.handlePageLength),t(".dlp-grid-container").each((function(e){i(t(this))}))}handleGridLoaded(){t("select.dlp-grid-taxonomy-filter").select2({dropdownCssClass:"dlp-grid-dropdown",minimumResultsForSearch:5,escapeMarkup:function(e){return e},language:{noResults:function(){return(0,e.__)("No results found","document-library-pro")}}}),t(".dlp-grid-length select").select2({dropdownCssClass:"dlp-grid-dropdown",minimumResultsForSearch:-1,escapeMarkup:function(e){return e},language:{noResults:function(){}}})}handleTaxonomyFilters(e){const a=t(this).parents(".dlp-grid-container").first(),r=a.find(".dlp-grid-reset"),d=a.attr("id");let l=a.find('.dlp-grid-search input[type="search"]').val();const s=n(a),o=t(".dlp-grid-length select").first().val();if(0===s.length&&l.length<dlp_grid_params.ajax_min_search_term_len){if(r.is(":hidden"))return;l="",r.hide()}else r.show();a.block({message:null,overlayCSS:{background:"#fff",opacity:.7}}),t.ajax({url:dlp_grid_params.ajax_url,type:"POST",data:{grid_id:d,search_query:l,search_filters:s,page_number:1,length:o,action:dlp_grid_params.ajax_action,_ajax_nonce:dlp_grid_params.ajax_nonce},xhrFields:{withCredentials:!0}}).done((function(e){i(a,e),a.unblock()})),a.addClass("grid-loaded")}handlePageLength(e){const a=t(this),r=a.parents(".dlp-grid-container").first(),d=r.attr("id");let l=r.find('.dlp-grid-search input[type="search"]').val();const s=n(r),o=a.val();r.find(".dlp-grid-length select").not(this).val(o),r.block({message:null,overlayCSS:{background:"#fff",opacity:.7}}),t.ajax({url:dlp_grid_params.ajax_url,type:"POST",data:{grid_id:d,search_query:l,search_filters:s,length:o,page_number:1,action:dlp_grid_params.ajax_action,_ajax_nonce:dlp_grid_params.ajax_nonce},xhrFields:{withCredentials:!0}}).done((function(e){i(r,e),r.unblock()})),r.addClass("grid-loaded")}handleFetchGrid(e){const a=t(this);if(a.hasClass("disabled")||a.hasClass("current"))return;const r=a.parents(".dlp-grid-container").first(),d=r.attr("id"),l=t(this).data("page-number"),s=t(".dlp-grid-length select").first().val();let o="";o=a.parents(".dlp-folders-search-results").first()?.length?a.parents(".dlp-folders-container").first().find('.dlp-folders-search input[type="search"]').val():r.find('.dlp-grid-search input[type="search"]').val(),o&&o.length<dlp_grid_params.ajax_min_search_term_len&&(o=""),r.block({message:null,overlayCSS:{background:"#fff",opacity:.7}}),t.ajax({url:dlp_grid_params.ajax_url,type:"POST",data:{grid_id:d,page_number:l,search_query:o,search_filters:n(r),length:s,action:dlp_grid_params.ajax_action,_ajax_nonce:dlp_grid_params.ajax_nonce},xhrFields:{withCredentials:!0}}).done((function(e){t("html, body").animate({scrollTop:r.offset().top-50},300),i(r,e),r.unblock()})),r.addClass("grid-loaded")}handleGridSearch(e){const a=t(this),r=a.parents(".dlp-grid-container").first(),d=r.find(".dlp-grid-reset"),l=r.attr("id");let s=r.find('.dlp-grid-search input[type="search"]').val();const o=t(".dlp-grid-length select").first().val(),c=n(r);if(r.find('.dlp-grid-search input[type="search"]').not(this).each((function(e){t(this).val(a.val())})),0===c.length&&s.length<dlp_grid_params.ajax_min_search_term_len){if(d.is(":hidden"))return;s="",d.hide()}else d.show();r.block({message:null,overlayCSS:{background:"#fff",opacity:.7}}),t.ajax({url:dlp_grid_params.ajax_url,type:"POST",data:{grid_id:l,search_query:s,search_filters:c,page_number:1,length:o,action:dlp_grid_params.ajax_action,_ajax_nonce:dlp_grid_params.ajax_nonce},xhrFields:{withCredentials:!0}}).done((function(e){i(r,e),r.unblock()})),r.addClass("grid-loaded")}handleGridReset(e){e.preventDefault();const a=t(this).parents(".dlp-grid-container").first(),n=a.find(".dlp-grid-reset"),r=a.attr("id"),d=a.find('.dlp-grid-search input[type="search"]'),l=a.find(".dlp-grid-length select");d.each((function(e){t(this).val("")})),a.find(".dlp-grid-taxonomy-filter").each((function(e){t(this).val("").trigger("change")})),l.val(l.find("option:first").val()).trigger("change"),n.hide(),a.block({message:null,overlayCSS:{background:"#fff",opacity:.7}}),t.ajax({url:dlp_grid_params.ajax_url,type:"POST",data:{grid_id:r,search_query:"",search_filters:[],page_number:1,length:l.val(),action:dlp_grid_params.ajax_action,_ajax_nonce:dlp_grid_params.ajax_nonce},xhrFields:{withCredentials:!0}}).done((function(e){i(a,e),a.unblock()}))}openPhotoswipe(e){e.stopPropagation();const a=t(".pswp")[0],n=t(this).find("img");if(n.length<1)return;const i=[{src:n.attr("data-large_image"),w:n.attr("data-large_image_width"),h:n.attr("data-large_image_height"),title:n.attr("data-caption")&&n.attr("data-caption").length?n.attr("data-caption"):n.attr("title")}];return new PhotoSwipe(a,PhotoSwipeUI_Default,i,{index:0,shareEl:!1,closeOnScroll:!1,history:!1,hideAnimationDuration:0,showAnimationDuration:0}).init(),!1}}}))})();